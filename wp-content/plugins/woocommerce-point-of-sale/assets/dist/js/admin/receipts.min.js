"use strict";function ownKeys(t,e){var o,i=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,o)),i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(o),!0).forEach(function(e){_defineProperty(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}!function(r,t){var s={admin:wc_pos_params,receipts:wc_pos_admin_receipts_params},c={id:"#wc-pos-receipt-form",watchFields:['[name="name"]','[name="show_title"]','[name="title_position"]','[name="width"]','[name="logo"]','[name="logo_position"]','[name="logo_size"]','[name="outlet_details_position"]','[name="show_shop_name"]','[name="show_outlet_name"]','[name="show_outlet_address"]','[name="show_outlet_contact_details"]','[name="social_details_position"]','[name="show_social_twitter"]','[name="show_social_facebook"]','[name="show_social_instagram"]','[name="show_social_snapchat"]','[name="show_wifi_details"]','[name="show_tax_number"]','[name="tax_number_label"]','[name="tax_number_position"]','[name="show_order_date"]','[name="order_date_format"]','[name="order_date_format_custom"]','[name="order_time_format"]','[name="order_time_format_custom"]','[name="show_customer_name"]','[name="show_customer_email"]','[name="show_customer_phone"]','[name="show_customer_shipping_address"]','[name="show_customer_billing_address"]','[name="show_cashier_name"]','[name="cashier_name_format"]','[name="product_details_layout"]','[name="show_register_name"]','[name="show_product_image"]','[name="show_product_sku"]','[name="show_product_cost"]','[name="show_product_discount"]','[name="show_no_items"]','[name="show_tax_summary"]','[name="show_order_barcode"]','[name="barcode_type"]','[name="header_text"]','[name="footer_text"]','[name="text_size"]'],cachedDateFormats:{},cachedTimeFormats:{},logoUploader:null,init:function(){r(this.id).on("submit",this.submitted).on("change keyup","input, select, textarea",this.changed).on("change keyup",this.watchFields.join(","),this.updatePreview).on("click","#customize-control-logo button.upload",this.selectLogo).on("click","#customize-control-logo button.remove",this.removeLogo).on("click","#customize-control-logo button.upload, #customize-control-logo button.remove",this.changed).find(this.watchFields.filter(function(e){return-1===['[name="order_date_format"]','[name="order_date_format_custom"]','[name="order_time_format"]','[name="order_time_format_custom"]'].indexOf(e)}).join(",")).trigger("change");var e=wp.codeEditor.initialize(r("#custom_css"),{codemirror:{lineNumbers:!0,mode:"css",indentUnit:4,indentWithTabs:!0}});this.updatePreviewCss(e.codemirror.doc.getValue()),e.codemirror.on("change",function(e){c.updatePreviewCss(e.doc.getValue()),r("#custom_css").val(e.doc.getValue())})},validate:function(e){var t={},o={};if(e.forEach(function(e){t[e.name]=e.value}),void 0!==t.name&&0!==t.name.trim().length||(o.name_is_empty=s.receipts.i18n_field_name_empty),void 0===t.width||0===t.width.trim().length?o.width_is_empty=s.receipts.i18n_field_width_empty:Number(t.width)<0&&(o.width_is_negative=s.receipts.i18n_field_width_negative),0<Object.keys(o).length){var i=r("#customize-notifications-area"),e=r(".wp-full-overlay-sidebar-content");i.children("ul").html(""),Object.values(o).forEach(function(e){i.children("ul").append('\n\t\t\t\t\t\t<li class="notice notice-error" data-code="client_side_error" data-type="error">\n\t\t\t\t\t\t\t<div class="notification-message">'.concat(e,"</div>\n\t\t\t\t\t\t</li>"))});o=i.outerHeight()+1;return e.css("top",45+o+"px"),!1}return!0},submitted:function(e){e.preventDefault(),r("body").addClass("saving"),c.validate(r(this).serializeArray())?(e={receipt_id:s.receipts.receipt_id,action:"wc_pos_update_receipt",data:r(this).serializeArray().reduce(function(e,t){return _objectSpread(_objectSpread({},e),{},_defineProperty({},t.name,t.value))}),security:s.receipts.update_receipt_nonce},r.ajax({url:s.admin.ajax_url,data:e,type:"POST",success:function(e){r("body").removeClass("saving"),e.success?(r(c.id).find('input[type="submit"]').prop("disabled",!0),0===s.receipts.receipt_id.length&&(t.location.href=s.admin.admin_url+"post.php?post="+e.data.id+"&action=edit")):t.alert(e.data.error)}})):r("body").removeClass("saving")},changed:function(){r(c.id).find('input[type="submit"]').prop("disabled",!1)},updatePreview:function(e){var t=r(e.target),o=t.attr("name"),i=t.val();if("name"===o&&r("#receipt-name").html(i),"show_title"===o&&(r(t).is(":checked")?r("#receipt-title").show():r("#receipt-title").hide()),"title_position"===o&&r("#receipt-title").css("text-align",i),"width"===o&&(i=(i=parseInt(i))&&0<i&&i<=120?"".concat(i,"mm"):"100%",r("#receipt-preview").css("width",i)),"logo"===o&&(0===parseInt(i)||0===i.length?r("#receipt-logo").hide():r("#receipt-logo").show()),"logo_position"===o&&r("#receipt-logo").css("text-align",i),"logo_size"===o){var a="auto";switch(i){case"normal":a="6cm";break;case"small":a="2cm";break;case"large":a="100%"}r("#receipt-logo img").css("width",a)}if("outlet_details_position"===o&&(r("#receipt-outlet-details").css("text-align",i),r("#receipt-outlet-details-footer").css("text-align",i)),"show_shop_name"===o&&(r(t).is(":checked")?r("#receipt-shop-name").show():r("#receipt-shop-name").hide()),"show_outlet_name"===o&&(r(t).is(":checked")?r("#receipt-outlet-name").show():r("#receipt-outlet-name").hide()),"show_outlet_address"===o&&(r(t).is(":checked")?r("#receipt-outlet-address").show():r("#receipt-outlet-address").hide()),"show_outlet_contact_details"===o&&(r(t).is(":checked")?r("#receipt-outlet-contact-details").show():r("#receipt-outlet-contact-details").hide()),"social_details_position"===o&&(e=r("#receipt-social-details"),"header"===i?e.insertAfter("#receipt-wifi-details"):"footer"===i&&e.appendTo("#receipt-outlet-details-footer")),"show_social_twitter"===o&&(r(t).is(":checked")?r("#receipt-social-twitter").show():r("#receipt-social-twitter").hide()),"show_social_facebook"===o&&(r(t).is(":checked")?r("#receipt-social-facebook").show():r("#receipt-social-facebook").hide()),"show_social_instagram"===o&&(r(t).is(":checked")?r("#receipt-social-instagram").show():r("#receipt-social-instagram").hide()),"show_social_snapchat"===o&&(r(t).is(":checked")?r("#receipt-social-snapchat").show():r("#receipt-social-snapchat").hide()),"show_wifi_details"===o&&(r(t).is(":checked")?r("#receipt-wifi-details").show():r("#receipt-wifi-details").hide()),"show_tax_number"===o&&(r(t).is(":checked")?r("#receipt-tax-number").show():r("#receipt-tax-number").hide()),"tax_number_label"===o&&(0<i.length?r("#receipt-tax-number-label").html(i+":"):r("#receipt-tax-number-label").html("")),"tax_number_position"===o&&r("#receipt-tax-number").css("text-align",i),"show_order_date"===o&&(r(t).is(":checked")?r("#receipt-order-date").show():r("#receipt-order-date").hide()),"order_date_format"===o||"order_date_format_custom"===o){if(i=""===r('[name="order_date_format"]:checked').val()?r('[name="order_date_format_custom"]').val():i,void 0!==c.cachedDateFormats[i])return void r("#receipt-order-date td .date").html(c.cachedDateFormats[i]);r.ajax({url:s.admin.ajax_url,data:{action:"wc_pos_date_i18n",security:s.receipts.date_i18n_nonce,data:{format:i,date:s.receipts.time}},type:"POST",success:function(e){e.success&&(r("#receipt-order-date td .date").html(e.data.date),c.cachedDateFormats[i]=e.data.date)}})}if("order_time_format"===o||"order_time_format_custom"===o){if(i=""===r('[name="order_time_format"]:checked').val()?r('[name="order_time_format_custom"]').val():i,void 0!==c.cachedTimeFormats[i])return void r("#receipt-order-date td .time").html(c.cachedTimeFormats[i]);r.ajax({url:s.admin.ajax_url,data:{action:"wc_pos_date_i18n",security:s.receipts.date_i18n_nonce,data:{format:i,date:s.receipts.date}},type:"POST",success:function(e){e.success&&(r("#receipt-order-date td .time").html(e.data.date),c.cachedTimeFormats[i]=e.data.date)}})}"show_customer_name"===o&&(r(t).is(":checked")?r("#receipt-customer-name").show():r("#receipt-customer-name").hide()),"show_customer_email"===o&&(r(t).is(":checked")?r("#receipt-customer-email").show():r("#receipt-customer-email").hide()),"show_customer_phone"===o&&(r(t).is(":checked")?r("#receipt-customer-phone").show():r("#receipt-customer-phone").hide()),"show_customer_shipping_address"===o&&(r(t).is(":checked")?r("#receipt-customer-shipping-address").show():r("#receipt-customer-shipping-address").hide()),"show_customer_billing_address"===o&&(r(t).is(":checked")?r("#receipt-customer-billing-address").show():r("#receipt-customer-billing-address").hide()),"show_cashier_name"===o&&(r(t).is(":checked")?r("#receipt-cashier-name").show():r("#receipt-cashier-name").hide()),"cashier_name_format"===o&&r("#receipt-cashier-name .cashier").html(r("#receipt-cashier-name").data(i)),"product_details_layout"===o&&("single"===i?(r(".receipt-product-details-layout-single").css("display","table-header-group"),r(".receipt-product-details-layout-multiple").css("display","none")):(r(".receipt-product-details-layout-multiple").css("display","table-header-group"),r(".receipt-product-details-layout-single").css("display","none"))),"show_register_name"===o&&(r(t).is(":checked")?r("#receipt-register-name").show():r("#receipt-register-name").hide()),"show_product_image"===o&&(r(t).is(":checked")?(r("thead th.image").show(),r(".receipt-product-image").show()):(r("thead th.image").hide(),r(".receipt-product-image").hide())),"show_product_sku"===o&&(r(t).is(":checked")?r(".receipt-product-sku").show():r(".receipt-product-sku").hide()),"show_product_cost"===o&&(r(t).is(":checked")?(r("thead th.cost").show(),r(".receipt-product-cost").show()):(r("thead th.cost").hide(),r(".receipt-product-cost").hide())),"show_product_discount"===o&&(r(t).is(":checked")?(r("#receipt-preview .show-if-discount-enabled").show(),r("#receipt-preview .line-through-if-discount-enabled").css("text-decoration","line-through")):(r("#receipt-preview .show-if-discount-enabled").hide(),r("#receipt-preview .line-through-if-discount-enabled").css("text-decoration","none"))),"show_no_items"===o&&(r(t).is(":checked")?r("#receipt-no-items").show():r("#receipt-no-items").hide()),"show_tax_summary"===o&&(r(t).is(":checked")?r("#receipt-tax-summary").show():r("#receipt-tax-summary").hide()),"show_order_barcode"===o&&(r(t).is(":checked")?r("#receipt-order-barcode").show():r("#receipt-order-barcode").hide()),"barcode_type"===o&&(t=document.createElement("canvas"),bwipjs.toCanvas(t,{bcid:i,text:"WC1234AE",scale:2,includetext:!0,textxalign:"center"}),r("#receipt-order-barcode img").attr("src",t.toDataURL("image/png"))),"header_text"===o&&r("#receipt-header-text").html(i),"footer_text"===o&&r("#receipt-footer-text").html(i),"text_size"===o&&r("#receipt-preview").removeClass("text-tiny text-small text-normal text-large").addClass("text-"+i)},selectLogo:function(){if(!c.logoUploader)return c.logoUploader=wp.media.frames.logoUploader=wp.media({title:"Select a Receipt Logo ",button:{text:"Set Receipt Logo"},multiple:!1,library:{type:"image/png,image/jpeg"}}),c.logoUploader.on("select",function(){var e=c.logoUploader.state().get("selection").first().toJSON();r("#logo").val(e.id).trigger("change"),r("#customize-control-logo").addClass("selected"),r("#customize-control-logo .attachment-thumb").attr("src",e.url),r("#receipt-preview #receipt-logo img").attr("src",e.url)}),c.logoUploader.open(),!1;c.logoUploader.open()},removeLogo:function(){return r("#logo").val("").trigger("change"),r("#customize-control-logo").removeClass("selected"),r("#customize-control-logo .attachment-thumb").attr("src",""),r("#receipt-preview #receipt-logo img").attr("src",""),!1},updatePreviewCss:function(e){r("#receipt-custom-css").replaceWith('<style type="text/less" id="receipt-custom-css">#receipt-preview {'.concat(e,"}</style>")),t.less&&t.less.refresh(!0)}};c.init(),r(c.id).find("#save").prop("disabled",!1),r(".customize-pane-parent").on("click",".accordion-section-title",function(e){e.preventDefault();e=r(this).parent().attr("aria-owns"),e=r("#"+e);r(".wp-full-overlay-sidebar-content").addClass("section-open"),e.addClass("open")}),r(".customize-pane-child").on("click",".customize-section-back",function(e){r(this).parents(".customize-pane-child").removeClass("open"),r(".wp-full-overlay-sidebar-content").removeClass("section-open")})}(jQuery,window,document);